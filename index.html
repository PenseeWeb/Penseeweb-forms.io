<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindmap Creation Process</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Added Supabase Script -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .progress-dots {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 2rem;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #E5E7EB;
            position: relative;
        }

        .dot.active {
            background: #6366F1;
            width: 10px;
            height: 10px;
        }

        .dot:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 12px;
            top: 50%;
            width: 40px;
            height: 2px;
            background: #E5E7EB;
            transform: translateY(-50%);
        }

        .promotion-banner {
            transform: translateY(100%);
            transition: transform 0.5s ease;
        }

        .promotion-banner.show {
            transform: translateY(0);
        }

        .blog-float {
            position: fixed;
            bottom: 20px;
            right: 20px;
            animation: float 3s ease-in-out infinite;
            max-width: 300px;
            z-index: 50;
            transition: transform 0.2s ease;
            display: none;
        }

        .blog-float.active {
            display: block;
        }

        .blog-float:hover {
            transform: translateY(-5px);
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }

        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }

        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }

        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }

        #page1 {
            background-color: #f8f1fc;
        }

        #page2 {
            background-color: #e5efff;
        }

        #page3 {
            background-color: #faeae6;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }
    </style>
</head>

<body class="min-h-screen">
<div class="container mx-auto px-4 py-8">
    <!-- Progress Dots -->
    <div class="progress-dots">
        <div class="dot active" id="dot1"></div>
        <div class="dot" id="dot2"></div>
        <div class="dot" id="dot3"></div>
    </div>

    <!-- Page 1: Create Your Mindmap -->
    [Your existing Page 1 HTML remains exactly the same]

    <!-- Page 2: Select Mindmap Version -->
    [Your existing Page 2 HTML remains exactly the same]

    <!-- Page 3: Complete Your Submission -->
    [Your existing Page 3 HTML remains exactly the same]

    <!-- Blog Promotion Float -->
    [Your existing Blog Float HTML remains exactly the same]

    <!-- Success Message Modal -->
    [Your existing Success Modal HTML remains exactly the same]

    <!-- Supabase Integration -->
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://rgccooiyalkqiugaxzbk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnY2Nvb2l5YWxrcWl1Z2F4emJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk5NjIzNzgsImV4cCI6MjA0NTUzODM3OH0.JomIxLPTFnGoxDf7WXpg41Vb9M-RKeZJ4oowSstaWT0';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Function to submit data to Supabase
        async function submitToSupabase(formData) {
            try {
                const { data, error } = await supabase
                    .from('mindmap_requests')
                    .insert([{
                        email: formData.email,
                        content_type: formData.type,
                        content: formData.content,
                        version: formData.version,
                        status: 'pending'
                    }]);

                if (error) throw error;
                return { success: true, data };
            } catch (error) {
                console.error('Error submitting to Supabase:', error);
                return { success: false, error: error.message };
            }
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('contentForm');
            const inputTypeSelect = document.getElementById('inputType');
            const youtubeInput = document.getElementById('youtubeInput');
            const textInput = document.getElementById('textInput');
            const customText = document.getElementById('customText');
            const charCount = document.getElementById('charCount');
            const textError = document.getElementById('textError');
            const youtubeLinkError = document.getElementById('youtubeLinkError');
            const successModal = document.getElementById('successModal');
            const gotItButton = document.getElementById('gotItButton');

            [Your existing event listeners and functions remain exactly the same until the email form submission]

            // Updated Email form submission with Supabase
            document.getElementById('emailForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                
                // Get stored data from localStorage
                const mindmapContent = JSON.parse(localStorage.getItem('mindmapContent'));
                const selectedVersion = localStorage.getItem('selectedVersion');

                const formData = {
                    email: email,
                    type: mindmapContent.type,
                    content: mindmapContent.content,
                    version: selectedVersion
                };

                // Submit to Supabase
                const result = await submitToSupabase(formData);

                if (result.success) {
                    localStorage.setItem('userEmail', email);
                    successModal.classList.remove('hidden');
                    
                    // Clear form data after successful submission
                    localStorage.removeItem('mindmapContent');
                    localStorage.removeItem('selectedVersion');
                } else {
                    alert('There was an error submitting your request. Please try again.');
                }
            });

            [Your existing gotItButton and other event listeners remain exactly the same]
        });

        [Your existing functions (selectVersion, goToPage, closeBlogFloat) remain exactly the same]
    </script>
</body>
</html>
