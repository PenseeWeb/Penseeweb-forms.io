<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PenseeWeb - Professional Mindmap Creation</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #faeae6;
            --accent-color: #d4756d;
            --text-color: #2c1810;
            --shadow-color: rgba(0,0,0,0.1);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Playfair Display', serif;
            background-color: var(--primary-color);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, rgba(250,234,230,0.8) 0%, rgba(212,117,109,0.1) 100%);
            z-index: -1;
        }
        .container {
            max-width: 500px;
            width: 100%;
            padding: 40px;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px var(--shadow-color);
            backdrop-filter: blur(10px);
            transform: translateZ(0);
            transition: 0.3s ease;
        }
        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px var(--shadow-color);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .header h1 {
            font-size: 3.5em;
            color: var(--accent-color);
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .header p {
            font-size: 1.2em;
            color: var(--text-color);
            opacity: 0.8;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: var(--text-color);
            font-weight: 500;
        }
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(212,117,109,0.2);
            border-radius: 12px;
            font-size: 1em;
            transition: 0.3s ease;
            background: rgba(255,255,255,0.9);
        }
        input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 15px rgba(212,117,109,0.2);
        }
        button {
            background: linear-gradient(135deg, var(--accent-color) 0%, #c26259 100%);
            color: #fff;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: 0.3s ease;
            width: 100%;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212,117,109,0.4);
        }

        .ad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(250, 234, 230, 0.95);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .ad-container {
            position: relative;
            max-width: 600px;
            width: 90%;
            background: var(--primary-color);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(212,117,109,0.3);
            animation: slideIn 0.5s ease-out;
        }

        .ad-header {
            text-align: center;
            margin-bottom: 10px;
            color: var(--accent-color);
            font-style: italic;
            font-family: 'Playfair Display', serif;
            line-height: 1.6;
            padding: 0 10px;
            font-size: 0.9em;
        }

        .tv-frame {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 15px;
            border: 8px solid #2a2a2a;
            box-shadow: 0 0 30px rgba(0,0,0,0.5),
                        inset 0 0 10px rgba(0,0,0,0.8);
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            overflow: hidden;
            background: linear-gradient(145deg, #232323 0%, #0a0a0a 100%);
        }

        .tv-frame::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 5px;
            background: #333;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .tv-screen {
            position: relative;
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            aspect-ratio: 16/9;
            border: 2px solid #444;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.8);
        }

        .ad-space {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
        }

        .ad-slot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.98);
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .ad-active {
            display: block;
            opacity: 1;
        }

        .tv-brand {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #888;
            font-family: 'Arial', sans-serif;
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0.7;
        }

        .ad-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 3;
        }

        .timer {
            background: rgba(212, 117, 109, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Poppins', sans-serif;
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .speaker-ad {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 250px;
            background: #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .speaker-ad-left {
            left: -75px;
        }

        .speaker-ad-right {
            right: -75px;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 1024px) {
            .speaker-ad {
                display: none; /* Hide speaker ads on mobile and tablet */
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            .header h1 {
                font-size: 2em;
            }
            .ad-container {
                width: 95%;
                padding: 15px;
            }
            .ad-header {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PenseeWeb</h1>
            <p>Create Your Professional Mindmap</p>
        </div>
        <form id="mindmapForm">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required placeholder="Enter your email to receive the mindmap">
            </div>
            <button type="submit" id="submitButton">Complete Submission</button>
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage">
                Submission Complete! üéâ<br>
                Your mindmap will be sent to your email within 24 hours.<br>
                Don't forget to check your spam folder!<br>‚ú®
            </div>
            <div class="note">
                Note: Due to our limited V2 system capacity, mindmap generation might take up to 24 hours. 
                We sincerely apologize for any delay or inconvenience. üôè
            </div>
        </form>
    </div>

    <div class="ad-overlay" id="adOverlay">
        <div class="ad-container">
            <div class="ad-header">
                "Dear visitor, we apologize for the brief interruption. As we strive to maintain and improve our services, 
                we rely on ad support. Your request has already been queued, and your mindmap will be delivered within 24 hours. 
                Thank you for your patience and understanding. ‚ú®"<br>
                <small>Note: We do not endorse or promote any content displayed in these ads. Please interact with discretion.</small>
            </div>
            <div class="tv-frame">
                <div class="tv-screen">
                    <div class="ad-space">
                        <div class="ad-slot" id="adSlot1">
                            <!-- First Ad -->
                            <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                            <div id="container-5a0a6d52f643547f356c1aeafcfac4f7"></div>
                        </div>
                        <div class="ad-slot" id="adSlot2">
                            <!-- Second Ad -->
                            <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                            <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-2"></div>
                        </div>
                        <div class="ad-slot" id="adSlot3">
                            <!-- Third Ad (Banner Size 300x250) -->
                            <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                            <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-3"></div>
                        </div>
                        <div class="ad-slot" id="adSlot4">
                            <!-- Fourth Ad -->
                            <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                            <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-4"></div>
                        </div>
                        <div class="ad-slot" id="adSlot5">
                            <!-- Fifth Ad -->
                            <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                            <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-5"></div>
                        </div>
                    </div>
                    <div class="tv-brand">PenseeWeb</div>
                </div>
                <div class="speaker-ad speaker-ad-left">
                    <!-- Speaker Left Ad -->
                    <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                    <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-6"></div>
                </div>
                <div class="speaker-ad speaker-ad-right">
                    <!-- Speaker Right Ad -->
                    <script async="async" data-cfasync="false" src="//pl25301828.profitablecpmrate.com/5a0a6d52f643547f356c1aeafcfac4f7/invoke.js"></script>
                    <div id="container-5a0a6d52f643547f356c1aeafcfac4f7-7"></div>
                </div>
                <div class="ad-controls">
                    <div class="timer" id="adTimer">14</div>
                    <button class="close-button" id="closeButton" style="display: none;">Close TV</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pop-up Ad Code -->
    <script type='text/javascript' src='//pl25301550.profitablecpmrate.com/89/7e/ce/897ece1951c038a06b458a8ced092a5c.js'></script>

    <script>
        const supabaseClient = supabase.createClient(
            'https://rgccooiyalkqiugaxzbk.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnY2Nvb2l5YWxrcWl1Z2F4emJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjk5NjIzNzgsImV4cCI6MjA0NTUzODM3OH0.JomIxLPTFnGoxDf7WXpg41Vb9M-RKeZJ4oowSstaWT0'
        );

        const adSystem = {
            async showAds() {
                const overlay = document.getElementById('adOverlay');
                const timer = document.getElementById('adTimer');
                const closeButton = document.getElementById('closeButton');
                const adSlots = [
                    document.getElementById('adSlot1'),
                    document.getElementById('adSlot2'),
                    document.getElementById('adSlot3'),
                    document.getElementById('adSlot4'),
                    document.getElementById('adSlot5')
                ];
                
                overlay.style.display = 'flex';
                
                let totalTime = 14;
                let currentAdIndex = 0;
                
                adSlots[currentAdIndex].classList.add('ad-active');

                return new Promise(resolve => {
                    const countdown = setInterval(() => {
                        timer.textContent = totalTime;
                        totalTime--;

                        // Switch ads every 3 seconds
                        if (totalTime % 3 === 0 || totalTime < 0) {
                            adSlots[currentAdIndex].classList.remove('ad-active');
                            currentAdIndex = (currentAdIndex + 1) % adSlots.length;
                            adSlots[currentAdIndex].classList.add('ad-active');
                        }
                        
                        // Show close button after 14 seconds
                        if (totalTime < 0) {
                            closeButton.style.display = 'block';
                            timer.textContent = '0';
                        }
                    }, 1000);

                    closeButton.onclick = () => {
                        clearInterval(countdown);
                        overlay.style.display = 'none';
                        adSlots.forEach(slot => slot.classList.remove('ad-active'));
                        resolve();
                    };
                });
            }
        };

        document.getElementById('mindmapForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const storedData = JSON.parse(localStorage.getItem('penseewebFormData'));
            
            if (!email) {
                document.getElementById('errorMessage').textContent = 'Please enter your email address';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }

            if (!storedData) {
                document.getElementById('errorMessage').textContent = 'No input data found. Please start from the beginning.';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }

            // Show ads first
            await adSystem.showAds();

            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const userIP = ipData.ip;

                const submissionData = {
                    email: email,
                    content: storedData.content,
                    input_type: storedData.input_type,
                    content_length: storedData.content_length,
                    processing_status: 'pending',
                    is_processed: false,
                    user_ip: userIP,
                    metadata: {
                        original_timestamp: storedData.timestamp,
                        submission_timestamp: new Date().toISOString()
                    }
                };

                const { error } = await supabaseClient
                    .from('penseeweb_forms')
                    .insert([submissionData]);

                if (error) throw error;

                localStorage.removeItem('penseewebFormData');
                document.getElementById('successMessage').style.display = 'block';
                document.getElementById('mindmapForm').reset();
                
                history.pushState(null, null, location.href);
                window.onpopstate = function() {
                    history.go(1);
                };

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('submitButton').disabled = false;
                document.getElementById('errorMessage').textContent = 'There was an error submitting your request. Please try again.';
                document.getElementById('errorMessage').style.display = 'block';
            }
        });

        window.onload = function() {
            const formData = localStorage.getItem('penseewebFormData');
            if (!formData) {
                document.getElementById('errorMessage').textContent = 'Please start from the beginning of the process.';
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('submitButton').disabled = true;
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            }
        };
    </script>
</body>
</html>
